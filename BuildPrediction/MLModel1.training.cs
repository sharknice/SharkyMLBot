﻿// This file was auto-generated by ML.NET Model Builder. 
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.ML.Data;
using Microsoft.ML.Trainers.FastTree;
using Microsoft.ML.Trainers;
using Microsoft.ML.Transforms;
using Microsoft.ML;

namespace BuildPrediction
{
    public partial class MLModel1
    {
        public static ITransformer RetrainPipeline(MLContext context, IDataView trainData)
        {
            var pipeline = BuildPipeline(context);
            var model = pipeline.Fit(trainData);

            return model;
        }

        /// <summary>
        /// build the pipeline that is used from model builder. Use this function to retrain model.
        /// </summary>
        /// <param name="mlContext"></param>
        /// <returns></returns>
        public static IEstimator<ITransformer> BuildPipeline(MLContext mlContext)
        {
            // Data process configuration with pipeline data transformations
            var pipeline = mlContext.Transforms.Categorical.OneHotEncoding(new []{new InputOutputColumnPair(@"MapName", @"MapName"),new InputOutputColumnPair(@"ProxyDetected", @"ProxyDetected"),new InputOutputColumnPair(@"ProxyActive", @"ProxyActive")}, outputKind: OneHotEncodingEstimator.OutputKind.Indicator)      
                                    .Append(mlContext.Transforms.ReplaceMissingValues(new []{new InputOutputColumnPair(@"ENEMY_PROTOSS_NEXUS", @"ENEMY_PROTOSS_NEXUS"),new InputOutputColumnPair(@"ENEMY_PROTOSS_OBSERVER", @"ENEMY_PROTOSS_OBSERVER"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ORACLE", @"ENEMY_PROTOSS_ORACLE"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ORACLESTASISTRAP", @"ENEMY_PROTOSS_ORACLESTASISTRAP"),new InputOutputColumnPair(@"ENEMY_PROTOSS_PHOENIX", @"ENEMY_PROTOSS_PHOENIX"),new InputOutputColumnPair(@"ENEMY_PROTOSS_PHOTONCANNON", @"ENEMY_PROTOSS_PHOTONCANNON"),new InputOutputColumnPair(@"ENEMY_PROTOSS_PROBE", @"ENEMY_PROTOSS_PROBE"),new InputOutputColumnPair(@"ENEMY_PROTOSS_PYLON", @"ENEMY_PROTOSS_PYLON"),new InputOutputColumnPair(@"ENEMY_PROTOSS_PYLONOVERCHARGED", @"ENEMY_PROTOSS_PYLONOVERCHARGED"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ROBOTICSBAY", @"ENEMY_PROTOSS_ROBOTICSBAY"),new InputOutputColumnPair(@"ENEMY_PROTOSS_MOTHERSHIPCORE", @"ENEMY_PROTOSS_MOTHERSHIPCORE"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ROBOTICSFACILITY", @"ENEMY_PROTOSS_ROBOTICSFACILITY"),new InputOutputColumnPair(@"ENEMY_PROTOSS_SHIELDBATTERY", @"ENEMY_PROTOSS_SHIELDBATTERY"),new InputOutputColumnPair(@"ENEMY_PROTOSS_STALKER", @"ENEMY_PROTOSS_STALKER"),new InputOutputColumnPair(@"ENEMY_PROTOSS_STARGATE", @"ENEMY_PROTOSS_STARGATE"),new InputOutputColumnPair(@"ENEMY_PROTOSS_TEMPEST", @"ENEMY_PROTOSS_TEMPEST"),new InputOutputColumnPair(@"ENEMY_PROTOSS_TEMPLARARCHIVE", @"ENEMY_PROTOSS_TEMPLARARCHIVE"),new InputOutputColumnPair(@"ENEMY_PROTOSS_TWILIGHTCOUNCIL", @"ENEMY_PROTOSS_TWILIGHTCOUNCIL"),new InputOutputColumnPair(@"ENEMY_PROTOSS_VOIDRAY", @"ENEMY_PROTOSS_VOIDRAY"),new InputOutputColumnPair(@"ENEMY_PROTOSS_WARPGATE", @"ENEMY_PROTOSS_WARPGATE"),new InputOutputColumnPair(@"ENEMY_PROTOSS_WARPPRISM", @"ENEMY_PROTOSS_WARPPRISM"),new InputOutputColumnPair(@"ENEMY_PROTOSS_WARPPRISMPHASING", @"ENEMY_PROTOSS_WARPPRISMPHASING"),new InputOutputColumnPair(@"ENEMY_PROTOSS_SENTRY", @"ENEMY_PROTOSS_SENTRY"),new InputOutputColumnPair(@"ENEMY_PROTOSS_MOTHERSHIP", @"ENEMY_PROTOSS_MOTHERSHIP"),new InputOutputColumnPair(@"ENEMY_PROTOSS_INTERCEPTOR", @"ENEMY_PROTOSS_INTERCEPTOR"),new InputOutputColumnPair(@"ENEMY_PROTOSS_IMMORTAL", @"ENEMY_PROTOSS_IMMORTAL"),new InputOutputColumnPair(@"EnemySelectedRace", @"EnemySelectedRace"),new InputOutputColumnPair(@"EnemyRace", @"EnemyRace"),new InputOutputColumnPair(@"MySelectedRace", @"MySelectedRace"),new InputOutputColumnPair(@"MyRace", @"MyRace"),new InputOutputColumnPair(@"Frame", @"Frame"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ADEPT", @"ENEMY_PROTOSS_ADEPT"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ADEPTPHASESHIFT", @"ENEMY_PROTOSS_ADEPTPHASESHIFT"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ARCHON", @"ENEMY_PROTOSS_ARCHON"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ASSIMILATOR", @"ENEMY_PROTOSS_ASSIMILATOR"),new InputOutputColumnPair(@"ENEMY_PROTOSS_CARRIER", @"ENEMY_PROTOSS_CARRIER"),new InputOutputColumnPair(@"ENEMY_PROTOSS_COLOSSUS", @"ENEMY_PROTOSS_COLOSSUS"),new InputOutputColumnPair(@"ENEMY_PROTOSS_CYBERNETICSCORE", @"ENEMY_PROTOSS_CYBERNETICSCORE"),new InputOutputColumnPair(@"ENEMY_PROTOSS_DARKSHRINE", @"ENEMY_PROTOSS_DARKSHRINE"),new InputOutputColumnPair(@"ENEMY_PROTOSS_DARKTEMPLAR", @"ENEMY_PROTOSS_DARKTEMPLAR"),new InputOutputColumnPair(@"ENEMY_PROTOSS_DISRUPTOR", @"ENEMY_PROTOSS_DISRUPTOR"),new InputOutputColumnPair(@"ENEMY_PROTOSS_DISRUPTORPHASED", @"ENEMY_PROTOSS_DISRUPTORPHASED"),new InputOutputColumnPair(@"ENEMY_PROTOSS_FLEETBEACON", @"ENEMY_PROTOSS_FLEETBEACON"),new InputOutputColumnPair(@"ENEMY_PROTOSS_FORGE", @"ENEMY_PROTOSS_FORGE"),new InputOutputColumnPair(@"ENEMY_PROTOSS_GATEWAY", @"ENEMY_PROTOSS_GATEWAY"),new InputOutputColumnPair(@"ENEMY_PROTOSS_HIGHTEMPLAR", @"ENEMY_PROTOSS_HIGHTEMPLAR"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ZEALOT", @"ENEMY_PROTOSS_ZEALOT"),new InputOutputColumnPair(@"ENEMY_PROTOSS_ASSIMILATORRICH", @"ENEMY_PROTOSS_ASSIMILATORRICH")}))      
                                    .Append(mlContext.Transforms.Concatenate(@"Features", new []{@"MapName",@"ProxyDetected",@"ProxyActive",@"ENEMY_PROTOSS_NEXUS",@"ENEMY_PROTOSS_OBSERVER",@"ENEMY_PROTOSS_ORACLE",@"ENEMY_PROTOSS_ORACLESTASISTRAP",@"ENEMY_PROTOSS_PHOENIX",@"ENEMY_PROTOSS_PHOTONCANNON",@"ENEMY_PROTOSS_PROBE",@"ENEMY_PROTOSS_PYLON",@"ENEMY_PROTOSS_PYLONOVERCHARGED",@"ENEMY_PROTOSS_ROBOTICSBAY",@"ENEMY_PROTOSS_MOTHERSHIPCORE",@"ENEMY_PROTOSS_ROBOTICSFACILITY",@"ENEMY_PROTOSS_SHIELDBATTERY",@"ENEMY_PROTOSS_STALKER",@"ENEMY_PROTOSS_STARGATE",@"ENEMY_PROTOSS_TEMPEST",@"ENEMY_PROTOSS_TEMPLARARCHIVE",@"ENEMY_PROTOSS_TWILIGHTCOUNCIL",@"ENEMY_PROTOSS_VOIDRAY",@"ENEMY_PROTOSS_WARPGATE",@"ENEMY_PROTOSS_WARPPRISM",@"ENEMY_PROTOSS_WARPPRISMPHASING",@"ENEMY_PROTOSS_SENTRY",@"ENEMY_PROTOSS_MOTHERSHIP",@"ENEMY_PROTOSS_INTERCEPTOR",@"ENEMY_PROTOSS_IMMORTAL",@"EnemySelectedRace",@"EnemyRace",@"MySelectedRace",@"MyRace",@"Frame",@"ENEMY_PROTOSS_ADEPT",@"ENEMY_PROTOSS_ADEPTPHASESHIFT",@"ENEMY_PROTOSS_ARCHON",@"ENEMY_PROTOSS_ASSIMILATOR",@"ENEMY_PROTOSS_CARRIER",@"ENEMY_PROTOSS_COLOSSUS",@"ENEMY_PROTOSS_CYBERNETICSCORE",@"ENEMY_PROTOSS_DARKSHRINE",@"ENEMY_PROTOSS_DARKTEMPLAR",@"ENEMY_PROTOSS_DISRUPTOR",@"ENEMY_PROTOSS_DISRUPTORPHASED",@"ENEMY_PROTOSS_FLEETBEACON",@"ENEMY_PROTOSS_FORGE",@"ENEMY_PROTOSS_GATEWAY",@"ENEMY_PROTOSS_HIGHTEMPLAR",@"ENEMY_PROTOSS_ZEALOT",@"ENEMY_PROTOSS_ASSIMILATORRICH"}))      
                                    .Append(mlContext.Transforms.Conversion.MapValueToKey(outputColumnName:@"Result",inputColumnName:@"Result"))      
                                    .Append(mlContext.MulticlassClassification.Trainers.OneVersusAll(binaryEstimator:mlContext.BinaryClassification.Trainers.FastTree(new FastTreeBinaryTrainer.Options(){NumberOfLeaves=4,MinimumExampleCountPerLeaf=17,NumberOfTrees=4,MaximumBinCountPerFeature=427,FeatureFraction=0.961154556282574,LearningRate=0.0555319353612355,LabelColumnName=@"Result",FeatureColumnName=@"Features"}),labelColumnName: @"Result"))      
                                    .Append(mlContext.Transforms.Conversion.MapKeyToValue(outputColumnName:@"PredictedLabel",inputColumnName:@"PredictedLabel"));

            return pipeline;
        }
    }
}
